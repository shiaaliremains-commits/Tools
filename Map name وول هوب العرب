local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Backpack = LocalPlayer:WaitForChild("Backpack")

-- Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¬Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
local EquippedTool = nil

-- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¯Ø§Ø© "ÙƒÙ„Ø¨Ø´Ù‡"
local function findTool(toolName)
    local tool = Backpack:FindFirstChild(toolName)
    if not tool then
        -- Ù†Ø­Ø§ÙˆÙ„ Ù†Ù„Ú¯Ø§Ù‡Ø§ Ø¨Ø§Ù„Ø¸Ù‡Ø±
        tool = Backpack:WaitForChild(toolName, 5) -- Ø§Ù†ØªØ¸Ø§Ø± 5 Ø«ÙˆØ§Ù†ÙŠ
    end
    return tool
end

-- Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¨Ø§Ù„ÙŠØ¯
local function getEquippedTool()
    if LocalPlayer.Character then
        for _, item in ipairs(LocalPlayer.Character:GetChildren()) do
            if item:IsA("Tool") and item.Name:lower():find("ÙƒÙ„Ø¨Ø´Ù‡") then
                return item
            end
        end
    end
    return nil
end

-- Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø¯Ø§Ø©
local function ensureToolEquipped()
    local tool = getEquippedTool()
    if tool then
        EquippedTool = tool
        return true
    end
    
    local backpackTool = findTool("ÙƒÙ„Ø¨Ø´Ù‡")
    if backpackTool and LocalPlayer.Character then
        LocalPlayer.Character:WaitForChild("Humanoid"):EquipTool(backpackTool)
        EquippedTool = backpackTool
        return true
    end
    
    EquippedTool = nil
    return false
end

local bodyParts = {
    "Head", "HumanoidRootPart", "LeftUpperArm", "RightUpperArm",
    "LeftLowerArm", "RightLowerArm", "LeftUpperLeg", "RightUpperLeg",
    "LeftLowerLeg", "RightLowerLeg", "Torso"
}

-- ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù‚ÙŠØ¯ÙŠÙ†
local cuffedPlayers = {}
local nextIndex = 1

-- ØªÙ‚ÙŠÙŠØ¯ (ÙƒÙ„Ø¨Ø´Ø©) Ø§Ù„Ù„Ø§Ø¹Ø¨
local function cuffPlayer(player)
    if player and player.Character and ensureToolEquipped() and EquippedTool then
        local remoteEvent = EquippedTool:FindFirstChild("RemoteEvent")
        if not remoteEvent then warn("Ù…Ø§ Ù„Ú¯ÙŠÙ†Ø§ RemoteEvent Ø¨Ø§Ù„Ø£Ø¯Ø§Ø©"); return false end

        for _, partName in pairs(bodyParts) do
            local part = player.Character:FindFirstChild(partName)
            if part then
                remoteEvent:FireServer("Cuff", part)
                wait(0.05)
            end
        end
        return true
    end
    return false
end

-- ØªØ­Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ø¹Ø¨
local function uncuffPlayer(player)
    if player and player.Character and ensureToolEquipped() and EquippedTool then
        local remoteEvent = EquippedTool:FindFirstChild("RemoteEvent")
        if remoteEvent then
            remoteEvent:FireServer("UnCuff", player.Character)
            return true
        else
            warn("Ù…Ø§ Ù„Ú¯ÙŠÙ†Ø§ RemoteEvent Ø¨Ø§Ù„Ø£Ø¯Ø§Ø©")
        end
    end
    return false
end

-- Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (GUI)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MOGGEDCuffControl"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 220, 0, 160)
MainFrame.Position = UDim2.new(1, -230, 0, 10)
MainFrame.AnchorPoint = Vector2.new(1, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 32)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleText = Instance.new("TextLabel")
TitleText.Size = UDim2.new(1, -40, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "**MOGGEDğŸ´â€â˜ ï¸ - ØªØ­ÙƒÙ… Ø§Ù„ÙƒÙ„Ø¨Ø´Ù‡**"
TitleText.TextColor3 = Color3.fromRGB(220, 220, 220)
TitleText.TextSize = 14
TitleText.Font = Enum.Font.GothamBold
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 1, 0)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundTransparency = 1
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CuffButton = Instance.new("TextButton")
CuffButton.Size = UDim2.new(0.85, 0, 0, 40)
CuffButton.Position = UDim2.new(0.075, 0, 0.25, 0)
CuffButton.Text = "**ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨**"
CuffButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
CuffButton.TextColor3 = Color3.new(1, 1, 1)
CuffButton.TextSize = 14
CuffButton.Font = Enum.Font.GothamBold
CuffButton.Parent = MainFrame

local CuffCorner = Instance.new("UICorner")
CuffCorner.CornerRadius = UDim.new(0, 8)
CuffCorner.Parent = CuffButton

local UnCuffButton = Instance.new("TextButton")
UnCuffButton.Size = UDim2.new(0.85, 0, 0, 40)
UnCuffButton.Position = UDim2.new(0.075, 0, 0.6, 0)
UnCuffButton.Text = "**ØªØ­Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ø¹Ø¨**"
UnCuffButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
UnCuffButton.TextColor3 = Color3.new(1, 1, 1)
UnCuffButton.TextSize = 14
UnCuffButton.Font = Enum.Font.GothamBold
UnCuffButton.Parent = MainFrame

local UnCuffCorner = Instance.new("UICorner")
UnCuffCorner.CornerRadius = UDim.new(0, 8)
UnCuffCorner.Parent = UnCuffButton

local TargetLabel = Instance.new("TextLabel")
TargetLabel.Size = UDim2.new(1, -20, 0, 20)
TargetLabel.Position = UDim2.new(0, 10, 0, 35)
TargetLabel.BackgroundTransparency = 1
TargetLabel.Text = "Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: Ù„Ø§ Ø£Ø­Ø¯"
TargetLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
TargetLabel.TextSize = 12
TargetLabel.Font = Enum.Font.Gotham
TargetLabel.Parent = MainFrame

local ToolStatusLabel = Instance.new("TextLabel")
ToolStatusLabel.Size = UDim2.new(1, -20, 0, 20)
ToolStatusLabel.Position = UDim2.new(0, 10, 0, 100)
ToolStatusLabel.BackgroundTransparency = 1
ToolStatusLabel.Text = "Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ø§Ø©: Ø¬Ø§Ù‡Ø²Ø©"
ToolStatusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
ToolStatusLabel.TextSize = 12
ToolStatusLabel.Font = Enum.Font.Gotham
ToolStatusLabel.Parent = MainFrame

-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ§Øª (Hover Effects)
local function createHoverEffect(button, normalColor, hoverColor)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor}):Play()
    end)
end

createHoverEffect(CuffButton, Color3.fromRGB(0, 100, 255), Color3.fromRGB(20, 120, 255))
createHoverEffect(UnCuffButton, Color3.fromRGB(220, 60, 60), Color3.fromRGB(240, 70, 70))

-- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
local function getNextPlayer()
    local allPlayers = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            table.insert(allPlayers, player)
        end
    end
    
    if #allPlayers == 0 then return nil end
    
    local target = allPlayers[nextIndex]
    nextIndex = nextIndex % #allPlayers + 1
    return target
end

-- ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
local function updateTargetLabel()
    local target = getNextPlayer()
    TargetLabel.Text = "Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: " .. (target and target.Name or "Ù„Ø§ Ø£Ø­Ø¯")
end

-- ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ø§Ø©
local function updateToolStatus(text, color)
    ToolStatusLabel.Text = "Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ø§Ø©: " .. text
    ToolStatusLabel.TextColor3 = color
end

-- Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªÙ‚ÙŠÙŠØ¯
CuffButton.MouseButton1Click:Connect(function()
    local target = getNextPlayer()
    if not target then return end
    
    if ensureToolEquipped() then
        updateToolStatus("Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", Color3.fromRGB(255, 200, 0))
        
        if cuffPlayer(target) then
            cuffedPlayers[target] = true
            updateTargetLabel()
            
            local originalColor = CuffButton.BackgroundColor3
            TweenService:Create(CuffButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 200, 0)}):Play()
            delay(0.3, function()
                TweenService:Create(CuffButton, TweenInfo.new(0.2), {BackgroundColor3 = originalColor}):Play()
            end)
            
            updateToolStatus("Ø¬Ø§Ù‡Ø²Ø©", Color3.fromRGB(0, 200, 0))
        else
            updateToolStatus("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠØ¯", Color3.fromRGB(255, 0, 0))
        end
    else
        updateToolStatus("ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©", Color3.fromRGB(255, 0, 0))
    end
end)

-- Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­Ø±ÙŠØ±
UnCuffButton.MouseButton1Click:Connect(function()
    if ensureToolEquipped() then
        updateToolStatus("Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", Color3.fromRGB(255, 200, 0))
        
        for player, _ in pairs(cuffedPlayers) do
            if uncuffPlayer(player) then
                cuffedPlayers[player] = nil
                
                local originalColor = UnCuffButton.BackgroundColor3
                TweenService:Create(UnCuffButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 200, 0)}):Play()
                delay(0.3, function()
                    TweenService:Create(UnCuffButton, TweenInfo.new(0.2), {BackgroundColor3 = originalColor}):Play()
                end)
                
                updateToolStatus("Ø¬Ø§Ù‡Ø²Ø©", Color3.fromRGB(0, 200, 0))
                break
            else
                updateToolStatus("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø±ÙŠØ±", Color3.fromRGB(255, 0, 0))
            end
        end
    else
        updateToolStatus("ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©", Color3.fromRGB(255, 0, 0))
    end
    updateTargetLabel()
end)

-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
Players.PlayerAdded:Connect(updateTargetLabel)
Players.PlayerRemoving:Connect(updateTargetLabel)

-- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ
local function checkToolAvailability()
    if not EquippedTool or not EquippedTool.Parent then
        if ensureToolEquipped() then
            updateToolStatus("Ø¬Ø§Ù‡Ø²Ø©", Color3.fromRGB(0, 200, 0))
        else
            updateToolStatus("ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©", Color3.fromRGB(255, 0, 0))
        end
    end
end

-- Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
updateTargetLabel()
checkToolAvailability()

-- Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
spawn(function()
    while wait(3) do
        checkToolAvailability()
    end
end)
